<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOCX Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f9; margin:0; padding:20px; }
    .container { max-width:600px; margin:auto; background:white; padding:20px; border-radius:8px; }
    .drop-area { border:2px dashed #2575fc; padding:30px; text-align:center; margin-bottom:15px; border-radius:6px; cursor:pointer; }
    .btn { display:block; width:100%; background:#2575fc; color:#fff; border:none; padding:12px; border-radius:6px; margin:8px 0; font-size:16px; cursor:pointer; }
    #status { margin-top:10px; text-align:center; }
    #downloadLink { display:none; margin-top:10px; }
    .html-preview { margin-top:20px; padding:15px; border:1px solid #ddd; background:#fafafa; max-height:200px; overflow:auto; }
  </style>
</head>
<body>
  <div class="container">
    <h2>DOCX Converter</h2>

    <div class="drop-area" id="dropArea">
      <p>Drag & Drop .docx file here<br>or click to browse</p>
      <input type="file" id="fileInput" hidden accept=".docx,.txt">
    </div>

    <button id="toPdfBtn" class="btn">Convert to PDF</button>
    <button id="toHtmlBtn" class="btn">Convert to HTML</button>

    <p id="status"></p>
    <a id="downloadLink" class="btn">Download</a>

    <div id="htmlPreview" class="html-preview" style="display:none;"></div>
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("dropArea");
    const status = document.getElementById("status");
    const downloadLink = document.getElementById("downloadLink");
    const htmlPreview = document.getElementById("htmlPreview");

    let selectedFile = null;

    // File select
    dropArea.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", e => {
      selectedFile = e.target.files[0];
      status.textContent = "Selected: " + selectedFile.name;
    });
    dropArea.addEventListener("dragover", e => e.preventDefault());
    dropArea.addEventListener("drop", e => {
      e.preventDefault();
      selectedFile = e.dataTransfer.files[0];
      status.textContent = "Selected: " + selectedFile.name;
    });

    // Convert to PDF
    document.getElementById("toPdfBtn").addEventListener("click", () => {
      if (!selectedFile) {
        status.textContent = "Please select a file first.";
        return;
      }
      if (selectedFile.type === "text/plain" || selectedFile.name.endsWith(".txt")) {
        convertTxt(selectedFile);
      } else if (selectedFile.name.endsWith(".docx")) {
        convertDocxToPdf(selectedFile);
      } else {
        status.textContent = "❌ Only TXT and DOCX supported.";
      }
    });

    // Convert to HTML
    document.getElementById("toHtmlBtn").addEventListener("click", () => {
      if (!selectedFile || !selectedFile.name.endsWith(".docx")) {
        status.textContent = "❌ Only DOCX files can be converted to HTML.";
        return;
      }
      convertDocxToHtml(selectedFile);
    });

    function convertTxt(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        generatePdfFromText(e.target.result, file.name.replace(/\.txt$/, ".pdf"));
      };
      reader.readAsText(file);
    }

    function convertDocxToPdf(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        mammoth.extractRawText({arrayBuffer: e.target.result}).then(result => {
          generatePdfFromText(result.value, file.name.replace(/\.docx$/, ".pdf"));
        });
      };
      reader.readAsArrayBuffer(file);
    }

    function convertDocxToHtml(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        mammoth.convertToHtml({arrayBuffer: e.target.result}).then(result => {
          const htmlContent = result.value;
          // Show preview
          htmlPreview.style.display = "block";
          htmlPreview.innerHTML = htmlContent;
          // Download as HTML file
          const blob = new Blob([htmlContent], { type: "text/html" });
          const url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.download = file.name.replace(/\.docx$/, ".html");
          downloadLink.style.display = "block";
          status.textContent = "✅ DOCX converted to HTML!";
        });
      };
      reader.readAsArrayBuffer(file);
    }

    function generatePdfFromText(text, filename) {
      const pdf = new jsPDF({ unit: "pt", format: "a4" });
      const margin = 40, lineHeight = 14, maxLineWidth = pdf.internal.pageSize.width - margin * 2;
      let y = margin;
      let lines = pdf.splitTextToSize(text, maxLineWidth);
      lines.forEach(line => {
        if (y + lineHeight > pdf.internal.pageSize.height - margin) {
          pdf.addPage();
          y = margin;
        }
        pdf.text(line, margin, y);
        y += lineHeight;
      });
      const blob = pdf.output("blob");
      const url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = filename;
      downloadLink.style.display = "block";
      status.textContent = "✅ File converted to PDF!";
    }
  </script>
</body>
</html>
