<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text & Word to PDF Converter</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Text & Word to PDF Converter</h1>

    <!-- Drag and Drop Upload -->
    <div id="drop-area" class="drop-area">
      <p>Drag & Drop your file here<br>or click to browse</p>
      <input type="file" id="fileInput" hidden>
    </div>

    <button id="uploadBtn">Convert to PDF</button>

    <!-- Progress Bar -->
    <div id="progressContainer" class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>

    <p id="status"></p>
  </div>

  <!-- Modal for PDF Preview -->
  <div id="previewModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <iframe id="pdfViewer" width="100%" height="500px"></iframe>
      <br>
      <a id="downloadBtn" class="btn" download="converted.pdf">Download PDF</a>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("drop-area");
    const uploadBtn = document.getElementById("uploadBtn");
    const status = document.getElementById("status");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    const previewModal = document.getElementById("previewModal");
    const closeModal = document.getElementById("closeModal");
    const pdfViewer = document.getElementById("pdfViewer");
    const downloadBtn = document.getElementById("downloadBtn");

    let selectedFile = null;

    // Drag & Drop
    dropArea.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", (e) => {
      selectedFile = e.target.files[0];
      status.textContent = `Selected: ${selectedFile.name}`;
    });

    dropArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropArea.classList.add("active");
    });
    dropArea.addEventListener("dragleave", () => dropArea.classList.remove("active"));
    dropArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dropArea.classList.remove("active");
      selectedFile = e.dataTransfer.files[0];
      status.textContent = `Selected: ${selectedFile.name}`;
    });

    // Upload + Preview
    uploadBtn.addEventListener("click", () => {
      if (!selectedFile) {
        status.textContent = "Please select or drop a file first.";
        return;
      }

      const formData = new FormData();
      formData.append("file", selectedFile);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload");

      // Reset progress
      progressBar.style.width = "0%";
      progressContainer.style.display = "block";
      status.textContent = "Uploading...";

      // Progress tracking
      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent + "%";
          status.textContent = `Uploading... ${Math.round(percent)}%`;
        }
      };

      // On complete
      xhr.onload = () => {
        if (xhr.status === 200) {
          const blob = new Blob([xhr.response], { type: "application/pdf" });
          const url = window.URL.createObjectURL(blob);

          // Show in modal
          pdfViewer.src = url;
          downloadBtn.href = url;
          previewModal.style.display = "block";

          status.textContent = "Preview ready!";
        } else {
          status.textContent = "Error converting file.";
        }
        progressContainer.style.display = "none";
      };

      xhr.onerror = () => {
        status.textContent = "Upload failed.";
        progressContainer.style.display = "none";
      };

      xhr.responseType = "blob";
      xhr.send(formData);
    });

    // Close modal
    closeModal.addEventListener("click", () => {
      previewModal.style.display = "none";
    });

    window.onclick = (event) => {
      if (event.target === previewModal) {
        previewModal.style.display = "none";
      }
    };
  </script>
</body>
</html>
